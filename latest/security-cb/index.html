<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">  
    <link rel="canonical" href="http://hortonworks.github.io/cloudbreak-documentation/security-cb/index.html"> 
    <link rel="shortcut icon" href="../images/favicon.png">

    <title>Configure Basic Security - Cloudbreak</title>

    <link href="../css/bootstrap-custom.min.css" rel="stylesheet">
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css" rel="stylesheet">
    <link rel="stylesheet" href="//cdn.jsdelivr.net/font-hack/2.018/css/hack.min.css">
    <link href='//fonts.googleapis.com/css?family=PT+Sans:400,400italic,700,700italic&subset=latin-ext,latin' rel='stylesheet' type='text/css'>
    <link href='//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,700italic,400,300,600,700&subset=latin-ext,latin' rel='stylesheet' type='text/css'>
    <link href="../css/base.css" rel="stylesheet">
    <link href="../css/cinder.css" rel="stylesheet">
    <link rel="stylesheet" href="../css/highlight.css">


    <link href="../css/extra.css" rel="stylesheet">

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

    <script src="https://ajax.googleapis.com/ajax/libs/webfont/1.5.18/webfont.js"></script>
    <script>
    WebFont.load({
        google: {
            families: ['Open Sans', 'PT Sans']
        }
    });
    </script>

    
    <script>
    (function(i, s, o, g, r, a, m) {
        i['GoogleAnalyticsObject'] = r;
        i[r] = i[r] || function() {
            (i[r].q = i[r].q || []).push(arguments)
        }, i[r].l = 1 * new Date();
        a = s.createElement(o),
        m = s.getElementsByTagName(o)[0];
        a.async = 1;
        a.src = g;
        m.parentNode.insertBefore(a, m)
    })(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');

    ga('create', 'UA-22950817-24', 'auto');
    ga('send', 'pageview');
    </script>
    
</head>

<body>

    <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            

            <!-- Main title -->
            <a class="navbar-brand" href="../index.html">Cloudbreak</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
            
                <!-- Main navigation -->
                <ul class="nav navbar-nav">
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Get Started <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../index.html">Introduction</a>
</li>

                        
                            
<li >
    <a href="../architecture/index.html">Architecture</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">AWS <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../aws-launch/index.html">Launch on AWS</a>
</li>

                        
                            
<li >
    <a href="../aws-create/index.html">Create a Cluster</a>
</li>

                        
                            
<li >
    <a href="../aws-clusters-access/index.html">Access Cluster</a>
</li>

                        
                            
<li >
    <a href="../aws-clusters-manage/index.html">Manage and Monitor Clusters</a>
</li>

                        
                            
<li >
    <a href="../aws-data/index.html">Access Data on S3</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Azure <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../azure-launch/index.html">Launch on Azure</a>
</li>

                        
                            
<li >
    <a href="../azure-create/index.html">Create a Cluster</a>
</li>

                        
                            
<li >
    <a href="../azure-clusters-access/index.html">Access Cluster</a>
</li>

                        
                            
<li >
    <a href="../azure-clusters-manage/index.html">Manage and Monitor Clusters</a>
</li>

                        
                            
<li >
    <a href="../azure-data/index.html">Access Data on Azure</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">GCP <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../gcp-launch/index.html">Launch on GCP</a>
</li>

                        
                            
<li >
    <a href="../gcp-create/index.html">Create a Cluster</a>
</li>

                        
                            
<li >
    <a href="../gcp-clusters-access/index.html">Access Cluster</a>
</li>

                        
                            
<li >
    <a href="../gcp-clusters-manage/index.html">Manage and Monitor Clusters</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">OpenStack <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../os-launch/index.html">Launch on Open Stack</a>
</li>

                        
                            
<li >
    <a href="../os-create/index.html">Create a Cluster</a>
</li>

                        
                            
<li >
    <a href="../os-clusters-access/index.html">Access Cluster</a>
</li>

                        
                            
<li >
    <a href="../os-clusters-manage/index.html">Manage and Monitor Clusters</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown active">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Using Cloudbreak <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Advanced Cluster Options</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../blueprints/index.html">Blueprints</a>
</li>

        
            
<li >
    <a href="../recipes/index.html">Recipes</a>
</li>

        
            
<li >
    <a href="../tags/index.html">Resource Tagging</a>
</li>

        
            
<li >
    <a href="../images/index.html">Custom Images</a>
</li>

        
            
<li >
    <a href="../autoscaling/index.html">Autoscaling</a>
</li>

        
    </ul>
  </li>

                        
                            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Managing Cloudbreak</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../vm-launch/index.html">Install on Your Own VM</a>
</li>

        
            
<li >
    <a href="../cb-upgrade/index.html">Upgrade Cloudbreak</a>
</li>

        
            
<li >
    <a href="../cb-credentials/index.html">Manage Cloudbreak Credentials</a>
</li>

        
            
<li >
    <a href="../cb-disable-provider/index.html">Disable Providers</a>
</li>

        
            
<li >
    <a href="../cb-db/index.html">Configure External Cloudbreak Database</a>
</li>

        
            
<li >
    <a href="../cb-migrate/index.html">Move Cloudbreak Instance</a>
</li>

        
            
<li >
    <a href="../cb-profile/index.html">Edit Cloudbreak Profile</a>
</li>

        
            
<li >
    <a href="../cb-delete/index.html">Delete Cloudbreak</a>
</li>

        
    </ul>
  </li>

                        
                            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Security</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../security/index.html">Security Overview</a>
</li>

        
            
<li class="active">
    <a href="index.html">Configure Basic Security</a>
</li>

        
            
<li >
    <a href="../security-kerberos/index.html">Enable Kerberos Security</a>
</li>

        
    </ul>
  </li>

                        
                            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">CLI</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../cli-install/index.html">Install the CLI</a>
</li>

        
            
<li >
    <a href="../cli-reference/index.html">CLI Reference</a>
</li>

        
    </ul>
  </li>

                        
                            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Troubleshooting</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../trouble-cb-logs/index.html">Cloudbreak Logs</a>
</li>

        
            
<li >
    <a href="../trouble-cb/index.html">General Troubleshooting</a>
</li>

        
            
<li >
    <a href="../trouble-aws/index.html">Troubleshooting AWS</a>
</li>

        
            
<li >
    <a href="../trouble-azure/index.html">Troubleshooting Azure</a>
</li>

        
            
<li >
    <a href="../trouble-gcp/index.html">Troubleshooting GCP</a>
</li>

        
            
<li >
    <a href="../trouble-os/index.html">Troubleshooting OpenStack</a>
</li>

        
    </ul>
  </li>

                        
                            
<li >
    <a href="../dev/index.html">Developer Documentation</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">More <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../releasenotes/index.html">Release Notes</a>
</li>

                        
                            
<li >
    <a href="../faq/index.html">FAQs</a>
</li>

                        
                            
<li >
    <a href="../get-help/index.html">Getting Help</a>
</li>

                        
                            
<li >
    <a href="../smartsense/index.html">SmartSense</a>
</li>

                        
                            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Legal</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../acknowledge/index.html">Acknowledgements</a>
</li>

        
    </ul>
  </li>

                        
                        </ul>
                    </li>
                
                
                </ul>
            

            <ul class="nav navbar-nav navbar-right">
                
                    <li >
                        <a rel="next" href="../security/index.html">
                            <i class="fa fa-arrow-left"></i> Previous
                        </a>
                    </li>
                    <li >
                        <a rel="prev" href="../security-kerberos/index.html">
                            Next <i class="fa fa-arrow-right"></i>
                        </a>
                    </li>
                
                
                    <li>
                        <a href="https://github.com/hortonworks/cloudbreak-documentation">
                            
                                <i class="fa fa-github"></i>
                            
                            GitHub
                        </a>
                    </li>
                
            </ul>
        </div>
    </div>
</div>

    <div class="container">
        
        <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
    
        <li class="first-level active"><a href="#securing-cloudbreak-after-launch">Securing Cloudbreak After Launch</a></li>
        
            <li class="second-level"><a href="#restricting-inbound-access-to-cloudbreak">Restricting Inbound Access to Cloudbreak</a></li>
            
        
            <li class="second-level"><a href="#restricting-inbound-access-to-clusters">Restricting Inbound Access to Clusters</a></li>
            
        
            <li class="second-level"><a href="#secure-the-profile">Secure the Profile</a></li>
            
        
            <li class="second-level"><a href="#add-ssl-certificate-for-cloudbreak-ui">Add SSL Certificate for Cloudbreak UI</a></li>
            
        
            <li class="second-level"><a href="#configure-access-from-custom-domains">Configure Access from Custom Domains</a></li>
            
        
    
    </ul>
</div></div>
        <div class="col-md-9" role="main">

<h2 id="securing-cloudbreak-after-launch">Securing Cloudbreak After Launch</h2>
<p>Cloudbreak comes with default settings designed for easy first experience rather than strict security. To secure Cloudbreak, follow these recommendations. </p>
<h3 id="restricting-inbound-access-to-cloudbreak">Restricting Inbound Access to Cloudbreak</h3>
<p>We recommend that you block all communication ports except 22, 80, and 443 on the Cloudbreak's security group. If you have to log in to the Cloudbreak host remotely, use the SSH port (usually 22).</p>
<h3 id="restricting-inbound-access-to-clusters">Restricting Inbound Access to Clusters</h3>
<p>We recommend that after launching Cloudbreak you set  CB_DEFAULT_GATEWAY_CIDR in your Cloudbreak's Profile file in order to automatically open ports 9443 and 22 to your Cloudbrak IP on your Ambari node security group. </p>
<p><strong>Steps</strong> </p>
<ol>
<li>
<p>Set CB_DEFAULT_GATEWAY_CIDR to the CIDR address range which is used by Cloudbreak to communicate with the cluster:</p>
<p><pre>export CB_DEFAULT_GATEWAY_CIDR=14.15.16.17/32</pre></p>
<p>Or, if your Cloudbreak communicates with the cluster through multiple addresses, set multiple addresses separated with a comma:</p>
<p><pre>export CB_DEFAULT_GATEWAY_CIDR=14.15.16.17/32,18.17.16.15/32</pre></p>
</li>
<li>
<p>If Cloudbreak has already been started, restart it using <code>cbd restart</code>.     </p>
</li>
<li>
<p>When CB_DEFAULT_GATEWAY_CIDR is set, two additional rules are added to your Ambari node security group: (1) port 9443 open to your Cloudbrak IP, and (2) port 22 open to your Cloudbrak IP. You can view and edit these default rules in the create cluster wizard. </p>
</li>
</ol>
<h3 id="secure-the-profile">Secure the Profile</h3>
<p>Before starting Cloudbreak for the first time, configure the Profile file as directed below. Changes are applied during startup so a restart (<code>cbd restart</code>) is required after each change.</p>
<ol>
<li>
<p>Execute the following command in the directory where you want to store Cloudbreak-related files:</p>
<p><pre>
echo export PUBLIC_IP=[the ip or hostname to bind] &gt; Profile
</pre></p>
</li>
<li>
<p>After you have a base Profile file, add the following custom properties to it:</p>
<p><pre>
export UAA_DEFAULT_SECRET='[custom secret]'
export UAA_DEFAULT_USER_EMAIL='[default admin email address]'
export UAA_DEFAULT_USER_PW='[default admin password]'
export UAA_DEFAULT_USER_FIRSTNAME='[default admin first name]'
export UAA_DEFAULT_USER_LASTNAME='[default admin last name]'
</pre></p>
<p>Cloudbreak has additional secrets which by default inherit their values from <code>UAA_DEFAULT_SECRET</code>. Instead of using the default, you can define different values in the Profile for each of these service clients:</p>
<p><pre>
export UAA_CLOUDBREAK_SECRET='[cloudbreak secret]'
export UAA_PERISCOPE_SECRET='[auto scaling secret]'
export UAA_ULUWATU_SECRET='[web ui secret]'
export UAA_SULTANS_SECRET='[authenticator secret]'
</pre></p>
<p>You can change these secrets at any time, except <code>UAA_CLOUDBREAK_SECRET</code> which is used to encrypt sensitive information at database level. </p>
<p><code>UAA_DEFAULT_USER_PW</code> is stored in plain text format, but if <code>UAA_DEFAULT_USER_PW</code> is missing from the Profile, it gets a default value. Because default password is not an option, if you set an empty password explicitly in the Profile Cloudbreak deployer will ask for password all the time when it is needed for the operation.</p>
<p><pre>
export UAA_DEFAULT_USER_PW=''
</pre></p>
<p>In this case, Cloudbreak deployer wouldn't be able to add the default user, so you have to do it manually by executing the following command:</p>
<p><pre>
cbd util add-default-user
</pre></p>
</li>
</ol>
<p>For more information about setting environment variables in Profile, refer to <a href="../cb-profile/index.html#configure-profile-variables">Configure Profile Variables</a>.</p>
<h3 id="add-ssl-certificate-for-cloudbreak-ui">Add SSL Certificate for Cloudbreak UI</h3>
<p>By default Cloudbreak has been configured with a self-signed certificate for access via HTTPS. This is sufficient for many deployments such as trials, development, testing, or staging. However, for production deployments, a trusted certificate is preferred and can be configured in the controller. Follow these steps to configure the cloud controller to use your own trusted certificate. </p>
<p><strong>Prerequisites</strong></p>
<p>To use your own certificate, you must have:</p>
<ul>
<li>A resolvable fully qualified domain name (FQDN) for the controller host IP address. For example, this can be set up in <a href="https://aws.amazon.com/documentation/route53/">Amazon Route 53</a>.  </li>
<li>A valid SSL certificate for this fully qualified domain name. The certificate can be obtained from a number of certificate providers.  </li>
</ul>
<p><strong>Steps</strong></p>
<ol>
<li>
<p>SSH to the Cloudbreak host instance:</p>
<p><pre><small>ssh -i mykeypair.pem cloudbreak@[CONTROLLER-IP-ADDRESS]</small></pre></p>
</li>
<li>
<p>Make sure that the target fully qualified domain name (FQDN) which you plan to use for Cloudbreak is resolvable:</p>
<p><pre><small>nslookup [TARGET-CONTROLLER-FQDN]</small></pre></p>
<p>For example:</p>
<p><pre><small>nslookup hdcloud.example.com</small></pre></p>
</li>
<li>
<p>Browse to the Cloudbreak deployment directory and edit the <code>Profile</code> file:</p>
<p><pre><small>vi /var/lib/cloudbreak-deployment/Profile</small></pre></p>
</li>
<li>
<p>Replace the value of the <code>PUBLIC_IP</code> variable with the <code>TARGET-CONTROLLER-FQDN</code> value:</p>
<p><pre><small>PUBLIC_IP=[TARGET-CONTROLLER-FQDN]</small></pre></p>
</li>
<li>
<p>Copy your private key and certificate files for the FQDN onto the Cloudbreak host. These files must be placed under <code>/var/lib/cloudbreak-deployment/certs/traefik/</code> directory.</p>
<blockquote>
<p>File permissions for the private key and certificate files can be set to 600.</p>
</blockquote>
<table>
<thead>
<tr>
<th>File</th>
<th>Example</th>
</tr>
</thead>
<tbody>
<tr>
<td>PRIV-KEY-LOCATION</td>
<td>/var/lib/cloudbreak-deployment/certs/traefik/hdcloud.example.com.key</td>
</tr>
<tr>
<td>CERT-LOCATION</td>
<td>/var/lib/cloudbreak-deployment/certs/traefik/hdcloud.example.com.crt</td>
</tr>
</tbody>
</table>
</li>
<li>
<p>Configure TLS details in your <code>Profile</code> by adding the following line at the end of the file.</p>
<blockquote>
<p>Notice that <code>CERT-LOCATION</code> and <code>PRIV-KEY-LOCATION</code> are file locations from Step 5, starting at the <code>/certs/...</code> path.</p>
</blockquote>
<p><pre><small>export CBD_TRAEFIK_TLS=”[CERT-LOCATION],[PRIV-KEY-LOCATION]”</small></pre></p>
<p>For example:</p>
<p><pre><small>export CBD_TRAEFIK_TLS="/certs/traefik/hdcloud.example.com.crt,/certs/traefik/hdcloud.example.com.key"</small></pre></p>
</li>
<li>
<p>Restart Cloudbreak deployer:</p>
<p><pre><small>cbd restart</small></pre></p>
</li>
<li>
<p>Using your web browser, access to the Cloudbreak UI using the new resolvable fully qualified domain name.</p>
</li>
<li>
<p>Confirm that the connection is SSL-protected and that the certificate used is the certificate that you provided to Cloudbreak.</p>
</li>
</ol>
<h3 id="configure-access-from-custom-domains">Configure Access from Custom Domains</h3>
<p>Cloudbreak deployer, which uses UAA as an identity provider, supports multitenancy. In UAA, multitenancy is managed through identity zones. An identity zone is accessed through a unique subdomain. For example, if the standard UAA responds to <code>https://uaa.10.244.0.34.xip.io</code>, a zone on this UAA can be accessed through a unique subdomain <code>https://testzone1.uaa.10.244.0.34.xip.io</code>.</p>
<p>If you want to use a custom domain for your identity or deployment, add the <code>UAA_ZONE_DOMAIN</code> line to your <code>Profile</code>:</p>
<pre>export UAA_ZONE_DOMAIN=my-subdomain.example.com</pre>

<p>This variable is necessary for UAA to identify which zone provider should handle the requests that arrive to that domain.</p></div>
        
    </div>

    <footer class="col-md-12 text-center">
        <hr>
        <p>
        <small>© 2011-2017 <a href="http://www.hortonworks.com" target="_blank">Hortonworks Inc</a>. All Rights Reserved. | <a href="http://hortonworks.com/privacy-policy/" target="_blank">Privacy Policy</a><br></small>
        
        <small>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</p></small>
    </footer>

    <script src="../js/jquery-1.10.2.min.js"></script>
    <script src="../js/bootstrap-3.0.3.min.js"></script>
    <script src="../js/highlight.pack.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script>
    var base_url = '..';
    </script>
    <script data-main="../mkdocs/js/search.js" src="../mkdocs/js/require.js"></script>
    <script src="../js/base.js"></script>

    <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">
                        <span aria-hidden="true">&times;</span>
                        <span class="sr-only">Close</span>
                    </button>
                    <h4 class="modal-title" id="exampleModalLabel">Search</h4>
                </div>
                <div class="modal-body">
                    <p>
                        From here you can search these documents. Enter your search terms below.
                    </p>
                    <form role="form">
                        <div class="form-group">
                            <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query">
                        </div>
                    </form>
                    <div id="mkdocs-search-results"></div>
                </div>
                <div class="modal-footer">
                </div>
            </div>
        </div>
    </div>

    </body>

</html>
