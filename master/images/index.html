<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">  
    <link rel="canonical" href="http://hortonworks.github.io/cloudbreak-documentation/images/index.html"> 
    <link rel="shortcut icon" href="../images/favicon.png">

    <title>Custom Images - Cloudbreak</title>

    <link href="../css/bootstrap-custom.min.css" rel="stylesheet">
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css" rel="stylesheet">
    <link rel="stylesheet" href="//cdn.jsdelivr.net/font-hack/2.018/css/hack.min.css">
    <link href='//fonts.googleapis.com/css?family=PT+Sans:400,400italic,700,700italic&subset=latin-ext,latin' rel='stylesheet' type='text/css'>
    <link href='//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,700italic,400,300,600,700&subset=latin-ext,latin' rel='stylesheet' type='text/css'>
    <link href="../css/base.css" rel="stylesheet">
    <link href="../css/cinder.css" rel="stylesheet">
    <link rel="stylesheet" href="../css/highlight.css">


    <link href="../css/extra.css" rel="stylesheet">

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

    <script src="https://ajax.googleapis.com/ajax/libs/webfont/1.5.18/webfont.js"></script>
    <script>
    WebFont.load({
        google: {
            families: ['Open Sans', 'PT Sans']
        }
    });
    </script>

    
    <script>
    (function(i, s, o, g, r, a, m) {
        i['GoogleAnalyticsObject'] = r;
        i[r] = i[r] || function() {
            (i[r].q = i[r].q || []).push(arguments)
        }, i[r].l = 1 * new Date();
        a = s.createElement(o),
        m = s.getElementsByTagName(o)[0];
        a.async = 1;
        a.src = g;
        m.parentNode.insertBefore(a, m)
    })(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');

    ga('create', 'UA-22950817-24', 'auto');
    ga('send', 'pageview');
    </script>
    
</head>

<body>

    <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            

            <!-- Main title -->
            <a class="navbar-brand" href="../index.html">Cloudbreak</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
            
                <!-- Main navigation -->
                <ul class="nav navbar-nav">
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Get Started <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../index.html">Introduction</a>
</li>

                        
                            
<li >
    <a href="../architecture/index.html">Architecture</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">AWS <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../aws-launch/index.html">Launch on AWS</a>
</li>

                        
                            
<li >
    <a href="../aws-create/index.html">Create a Cluster</a>
</li>

                        
                            
<li >
    <a href="../aws-clusters-access/index.html">Access Cluster</a>
</li>

                        
                            
<li >
    <a href="../aws-clusters-manage/index.html">Manage and Monitor Clusters</a>
</li>

                        
                            
<li >
    <a href="../aws-data/index.html">Access Data on S3</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Azure <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../azure-launch/index.html">Launch on Azure</a>
</li>

                        
                            
<li >
    <a href="../azure-create/index.html">Create a Cluster</a>
</li>

                        
                            
<li >
    <a href="../azure-clusters-access/index.html">Access Cluster</a>
</li>

                        
                            
<li >
    <a href="../azure-clusters-manage/index.html">Manage and Monitor Clusters</a>
</li>

                        
                            
<li >
    <a href="../azure-data/index.html">Access Data on Azure</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">GCP <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../gcp-launch/index.html">Launch on GCP</a>
</li>

                        
                            
<li >
    <a href="../gcp-create/index.html">Create a Cluster</a>
</li>

                        
                            
<li >
    <a href="../gcp-clusters-access/index.html">Access Cluster</a>
</li>

                        
                            
<li >
    <a href="../gcp-clusters-manage/index.html">Manage and Monitor Clusters</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">OpenStack <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../os-launch/index.html">Launch on Open Stack</a>
</li>

                        
                            
<li >
    <a href="../os-create/index.html">Create a Cluster</a>
</li>

                        
                            
<li >
    <a href="../os-clusters-access/index.html">Access Cluster</a>
</li>

                        
                            
<li >
    <a href="../os-clusters-manage/index.html">Manage and Monitor Clusters</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown active">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Using Cloudbreak <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Advanced Cluster Options</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../blueprints/index.html">Blueprints</a>
</li>

        
            
<li >
    <a href="../recipes/index.html">Recipes</a>
</li>

        
            
<li >
    <a href="../tags/index.html">Resource Tagging</a>
</li>

        
            
<li class="active">
    <a href="index.html">Custom Images</a>
</li>

        
    </ul>
  </li>

                        
                            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Managing Cloudbreak</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../vm-launch/index.html">Install on Your Own VM</a>
</li>

        
            
<li >
    <a href="../upgrade/index.html">Upgrade Clodbreak</a>
</li>

        
            
<li >
    <a href="../delete/index.html">Delete Cloudbreak</a>
</li>

        
            
<li >
    <a href="../credentials/index.html">Manage Cloudbreak Credentials</a>
</li>

        
            
<li >
    <a href="../profile/index.html">Configure Cloudbreak</a>
</li>

        
            
<li >
    <a href="../cb-db/index.html">Manage Cloudbreak Database</a>
</li>

        
    </ul>
  </li>

                        
                            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Security</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../security/index.html">Security Overview</a>
</li>

        
            
<li >
    <a href="../security-cb/index.html">Configure Basic Security</a>
</li>

        
            
<li >
    <a href="../security-kerberos/index.html">Configure Kerberos</a>
</li>

        
    </ul>
  </li>

                        
                            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">CLI</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../cli-install/index.html">Install the CLI</a>
</li>

        
            
<li >
    <a href="../cli-reference/index.html">CLI Reference</a>
</li>

        
    </ul>
  </li>

                        
                            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Troubleshooting</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../trouble-cb/index.html">General Troubleshooting</a>
</li>

        
            
<li >
    <a href="../trouble-aws/index.html">Troubleshooting AWS</a>
</li>

        
            
<li >
    <a href="../trouble-azure/index.html">Troubleshooting Azure</a>
</li>

        
            
<li >
    <a href="../trouble-gcp/index.html">Troubleshooting GCP</a>
</li>

        
            
<li >
    <a href="../trouble-os/index.html">Troubleshooting OpenStack</a>
</li>

        
    </ul>
  </li>

                        
                            
<li >
    <a href="../dev/index.html">Developer Documentation</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">More <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../releasenotes/index.html">Release Notes</a>
</li>

                        
                            
<li >
    <a href="../faq/index.html">FAQs</a>
</li>

                        
                            
<li >
    <a href="../get-help/index.html">Getting Help</a>
</li>

                        
                            
<li >
    <a href="../smartsense/index.html">SmartSense</a>
</li>

                        
                            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Legal</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../acknowledge/index.html">Acknowledgements</a>
</li>

        
    </ul>
  </li>

                        
                        </ul>
                    </li>
                
                
                </ul>
            

            <ul class="nav navbar-nav navbar-right">
                
                    <li >
                        <a rel="next" href="../tags/index.html">
                            <i class="fa fa-arrow-left"></i> Previous
                        </a>
                    </li>
                    <li >
                        <a rel="prev" href="../vm-launch/index.html">
                            Next <i class="fa fa-arrow-right"></i>
                        </a>
                    </li>
                
                
                    <li>
                        <a href="https://github.com/hortonworks/cloudbreak-documentation">
                            
                                <i class="fa fa-github"></i>
                            
                            GitHub
                        </a>
                    </li>
                
            </ul>
        </div>
    </div>
</div>

    <div class="container">
        
        <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
    
        <li class="first-level active"><a href="#custom-images">Custom Images</a></li>
        
            <li class="second-level"><a href="#building-custom-images">Building Custom Images</a></li>
            
        
            <li class="second-level"><a href="#preparing-the-json-file-with-image-catalog">Preparing the JSON File with Image Catalog</a></li>
            
                <li class="third-level"><a href="#structure-of-the-image-catalog-json-file">Structure of the Image Catalog JSON File</a></li>
            
                <li class="third-level"><a href="#example-image-catalog-json-file">Example Image Catalog JSON File</a></li>
            
        
            <li class="second-level"><a href="#register-custom-images">Register Custom Images</a></li>
            
        
    
    </ul>
</div></div>
        <div class="col-md-9" role="main">

<h2 id="custom-images">Custom Images</h2>
<p>By default, Cloudbreak launches clusters from <strong>standard default images</strong>, which include default configuration and default tooling. These images are available by default for each supported provider and region. </p>
<p>Since the standard default images may not fit the requirements of some users (for example when user requirements include custom OS hardening, custom libraries, custom tooling, and so on), Cloudbeak allows you to use your own <strong>custom images</strong>.</p>
<p>In order to use your own custom images you must:</p>
<ol>
<li>Build your custom images </li>
<li>Prepare the image catalog JSON file </li>
<li>Register your custom images with Cloudbreak  </li>
<li>Select a custom image when creating a cluster</li>
</ol>
<h3 id="building-custom-images">Building Custom Images</h3>
<p>Refer to <a href="https://github.com/hortonworks/cloudbreak-images">Custom Images for Cloudbreak</a>. This repository includes instructions and scripts to help you build custom images. Once you have the images, refer to the documentation below for information on how to create an image catalog, and register and use these images with Cloudbreak.</p>
<h3 id="preparing-the-json-file-with-image-catalog">Preparing the JSON File with Image Catalog</h3>
<p>Once you've built the custom images, you must create an image catalog JSON file. An example is available <a href="#example-image-catalog-json-file">here</a>.  </p>
<h4 id="structure-of-the-image-catalog-json-file">Structure of the Image Catalog JSON File</h4>
<p>The image catalog JSON file includes the following two high-level sections: </p>
<ul>
<li><code>images</code>: Contains information about the burned images.   </li>
<li><code>versions</code>: Contains the mappings between Cloudbreak versions and the image identifiers of burned images available for these versions in the list under the <code>cloudrbeak</code> key.  </li>
</ul>
<p>The burned images are stored in the <code>images</code> section in three categories, based on the platform that is pre-warmed:</p>
<ul>
<li><code>base-images</code>: Contains the non pre-warmed images  </li>
<li><code>hdf-images</code>: Contains the HDF related images  </li>
<li><code>hdp-images</code>: Contains the HDP related images  </li>
</ul>
<p>Each of these sections stores image "records". Every image "record" must contain the <code>os</code>, <code>date</code>, <code>uuid</code> and <code>images</code> fields. The <code>uuid</code> field must be a unique identifier within the file, and the <code>images</code> field must contain a map that contains the image sets by a provider and an image set must store the virtual machine image IDs by the related region of the provider. The virtual machine image IDs come from the result of the image burning process and must be an existing identifier of a virtual machine image on the related provider side.  </p>
<p>In addition, the platform-related images (<code>hdf-images</code> and <code>hdp-images</code>) must contain the version and repo information of the pre-warmed Ambari and platform (<strong>HDF/HDP</strong>) images: the <code>version</code>, <code>repo</code>, and <code>stack-details</code> fields. The <code>repo</code> field must contain the Ambari's installer package <strong>URL</strong> by the given os-type. The <code>stack-details</code> field must contain a <code>version</code> field, which identifies the version of the pre-warmed platform and, a <code>repo</code> field, which contains the necessary package information for the platform. </p>
<p>For the providers which use global rather than per-region images, the region should be replaced with <strong><code>default</code></strong>, as the example image catalog JSON illustrates.</p>
<h4 id="example-image-catalog-json-file">Example Image Catalog JSON File</h4>
<pre>
{
  "images": {
    "base-images": [
      {
        "date": "2017-10-13",
        "description": "Cloudbreak official base image",
        "images": {
          "mock": {
            "default": "mockimage/hdc-hdp--1710161226.tar.gz"
          }
        },
        "os": "centos7",
        "uuid": "f6e778fc-7f17-4535-9021-515351df3691"
      },
      {
        "date": "2017-10-13",
        "description": "Cloudbreak official base image",
        "images": {
          "aws": {
            "ap-northeast-1": "ami-78e9311e",
            "ap-northeast-2": "ami-84b613ea",
            "ap-southeast-1": "ami-75226716",
            "ap-southeast-2": "ami-92ce23f0",
            "eu-central-1": "ami-d95be5b6",
            "eu-west-1": "ami-46429e3f",
            "sa-east-1": "ami-86d5abea",
            "us-east-1": "ami-51a2742b",
            "us-west-1": "ami-21ccfe41",
            "us-west-2": "ami-2a1cdc52"
          },
          "gcp": {
            "default": "sequenceiqimage/hdc-hdp--1710161226.tar.gz"
          },
          "openstack": {
            "default": "hdc-hdp--1710161226"
          }
        },
        "os": "centos7",
        "uuid": "f6e778fc-7f17-4535-9021-515351df3692"
      }
    ],
    "hdf-images": [],
    "hdp-images": [
      {
        "date": "2017-08-07",
        "description": "Cloudbreak official image",
        "images": {
          "aws": {
            "ap-northeast-1": "ami-e621ca80",
            "ap-northeast-2": "ami-6a29f004",
            "ap-southeast-1": "ami-3e01985d",
            "ap-southeast-2": "ami-ed253c8e",
            "eu-central-1": "ami-76812f19",
            "eu-west-1": "ami-8d3dcbf4",
            "sa-east-1": "ami-1897e174",
            "us-east-1": "ami-5428072f",
            "us-west-1": "ami-36351e56",
            "us-west-2": "ami-b7d435cf"
          },
          "azure": null,
          "gcp": null,
          "openstack": null
        },
        "os": "centos6",
        "uuid": "2.4.2.2-1-aec0d3ca-e04a-47bf-9970-d649b0c579b9-2.5.0.1-265",
        "stack-details": {
          "repo": {
            "stack": {
              "redhat6": "http://private-repo-1.hortonworks.com/HDP/centos6/2.x/updates/2.5.0.1-265",
              "repoid": "HDP-2.5"
            },
            "util": {
              "redhat6": "http://private-repo-1.hortonworks.com/HDP-UTILS-1.1.0.21/repos/centos6",
              "repoid": "HDP-UTILS-1.1.0.21"
            }
          },
          "version": "2.5.0.1-265"
        },
        "repo": {
          "redhat6": "http://private-repo-1.hortonworks.com/ambari/centos6/2.x/updates/2.4.2.2-1/"
        },
        "version": "2.4.2.2-1"
      }
    ]
  },
  "versions": {
    "cloudbreak": [
      {
        "images": [
          "f6e778fc-7f17-4535-9021-515351df3691",
          "f6e778fc-7f17-4535-9021-515351df3692",
          "2.4.2.2-1-aec0d3ca-e04a-47bf-9970-d649b0c579b9-2.5.0.1-265"
        ],
        "versions": [
          "2.1.0-rc.1"
        ]
      }
    ]
  }
}
</pre>

<h3 id="register-custom-images">Register Custom Images</h3>
<p>Register your custom images in Cloudbreak by using the following steps. In general, you must edit your Profile file, by adding <code>export CB_IMAGE_CATALOG_URL=</code> pointing to the JSON file which contains your image catalog. </p>
<p>You may register the images either before starting Cloudbreak or after Cloudbreak is already running. </p>
<p><strong>Steps</strong></p>
<ol>
<li>SSH to the Cloudbreak VM and navigate to the Cloudbreak deployment directory, which usually is <code>/var/lib/cloudbreak-deployment</code> and edit the Profile file.</li>
<li>To register your custom images, add <code>export CB_IMAGE_CATALOG_URL=</code> to your profile and set it to the location of your <code>JSON</code> file which declares your custom images. Its value can be:  <ul>
<li>A <strong>URL</strong> of a remote file that is reachable by Cloudbreak through HTTP/HTTPS or  </li>
<li>A <strong>path</strong> to the file, relative to the <code>/var/lib/cloudbreak-deployment/etc</code> directory on the Cloudbreak host. The<code>etc</code> directory does not exist by default so you must create it. For example If you have an image catalog file called "custom-catalog.json" located in the <code>/var/lib/cloudbreak-deployment/etc</code> directory, you can simply enter in your Profile <code>export CB_IMAGE_CATALOG_URL=custom-catalog.json</code>.  </li>
</ul>
</li>
<li>If you register images after Cloudbreak has been started, you may need to wait until the cached data is refreshed.
Cloudbreak stores the image catalog related data only for 15 minutes.</li>
</ol></div>
        
    </div>

    <footer class="col-md-12 text-center">
        <hr>
        <p>
        <small>© 2011-2017 <a href="http://www.hortonworks.com" target="_blank">Hortonworks Inc</a>. All Rights Reserved. | <a href="http://hortonworks.com/privacy-policy/" target="_blank">Privacy Policy</a><br></small>
        
        <small>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</p></small>
    </footer>

    <script src="../js/jquery-1.10.2.min.js"></script>
    <script src="../js/bootstrap-3.0.3.min.js"></script>
    <script src="../js/highlight.pack.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script>
    var base_url = '..';
    </script>
    <script data-main="../mkdocs/js/search.js" src="../mkdocs/js/require.js"></script>
    <script src="../js/base.js"></script>

    <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">
                        <span aria-hidden="true">&times;</span>
                        <span class="sr-only">Close</span>
                    </button>
                    <h4 class="modal-title" id="exampleModalLabel">Search</h4>
                </div>
                <div class="modal-body">
                    <p>
                        From here you can search these documents. Enter your search terms below.
                    </p>
                    <form role="form">
                        <div class="form-group">
                            <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query">
                        </div>
                    </form>
                    <div id="mkdocs-search-results"></div>
                </div>
                <div class="modal-footer">
                </div>
            </div>
        </div>
    </div>

    </body>

</html>
